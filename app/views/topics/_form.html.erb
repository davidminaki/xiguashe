<div class="home-index">
  <div class="row">
    <div class="col-xs-12">
      <div class="topic-form">
        <h4>发表话题</h4>
        
          <%= form_for @topic, html: { multipart: true, role: 'form'} do |f| %>

            <%= render partial: 'public/model_errors', locals: { model_errors: @topic } %>

            <div class="form-group">
              <%= f.text_field :title, class: 'form-control', placeholder: '取个有意思的标题吧……'%>
            </div>
            <div class="form-group">
              <%= f.text_area :content, id: 'content-box', class: 'form-control', cols: '30', rows: '10',  placeholder: '发挥下你的创作灵感……' %>
            </div>
            <div class="form-group">
              <%= file_field_tag 'photo[]', multiple: "multiple" %>
            </div>
            <%= f.hidden_field :user_id, value: current_user.id %>

            <%= f.submit '发表', class: 'btn btn-primary' %>
          <% end %>
      </div>
    </div>
  </div>
</div>

<script>
  var params = {
    fileInput: $("#photo_").get(0),

    filter: function(files) {
		  var arrFiles = [];
		  for (var i = 0, file; file = files[i]; i++) {
			  if (file.type.indexOf("image") == 0) {
				  if (file.size >= 512000) {
					  alert('您这张"'+ file.name +'"图片大小过大，应小于500k');	
          } 
          else {
					  arrFiles.push(file);	
				  }			
        } 
        else {
				  alert('文件"' + file.name + '"不是图片。');	
			  }
		  }
		  return arrFiles;
	  },
    onSelect: function(files) {
      var funAppendImage = function() {
        file = files[i];
        if (file) {
          $.ajax({
            type: 'post',
            url: '',
            data: ''
            success: function(msg) {
            }
          });
        }
      }
    }
  };

  ZXXFILE = $.extend(ZXXFILE, params);
  ZXXFILE.init();
</script>
  
